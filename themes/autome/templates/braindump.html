{% extends "base.html" %}

{% block content %}
<h1>{{ section.title }}</h1>

{{ section.content | safe }}

<p style="margin-bottom:1cm;"></p>

<h2>blurbs</h2>
{% set subsection = get_section(path="braindump/blurbs/_index.md") %}
<div class="blurb-filters">
    <div class="search-box">
        <input type="text" id="search-input" placeholder="Search by title">
    </div>
    <div class="tag-filter">
        <select id="tag-select">
            <option value="">All tags</option>
        </select>
    </div>
</div>
<p style="margin-bottom:1cm;"></p>

<div id="blurb-list">
    {% for page in subsection.pages %}
    {% set slug = page.title | slugify %}
    <div class="blurb" id="{{ slug }}" data-tags="{{ page.extra.tags | join(sep=',') }}" data-date="{{ page.date }}">
        <div class="blurb-header">
            <button class="toggle-btn">view</button>
            <h3 class="blurb-title">
                <a href="#{{ slug }}">{{ page.title }}</a>
            </h3>
            <div class="blurb-meta">
                <span class="date">{{ page.date }}</span>
                <div class="tags">
                    {% for tag in page.extra.tags %}
                    <span class="tag">{{ tag }}</span>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="blurb-content">
            {{ page.content | safe }}
        </div>
    </div>
    {% endfor %}
</div>

<script>
    const searchInput = document.getElementById('search-input');
    const blurbList = document.getElementById('blurb-list');
    function filterBlurbs() {
        const searchTerm = searchInput.value.toLowerCase();
        Array.from(blurbList.children).forEach(blurb => {
            const title = blurb.querySelector('.blurb-title').textContent.toLowerCase();
            const matchesSearch = title.includes(searchTerm);
            if (matchesSearch) {
                blurb.style.display = 'block';
            } else {
                blurb.style.display = 'none';
            }
        });
    }
    searchInput.addEventListener('input', filterBlurbs);
</script>
{% endblock content %}